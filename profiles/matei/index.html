<!doctype html>
<html lang="ro" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Matei Mincu (@matei@mstdn.ro) — Romania RSS Feed</title>
  <meta name="description" content="">
  <link rel="canonical" href="https://romania-rss-feed.github.io/profiles/matei/">
  <link rel="alternate" type="application/rss+xml" title="Matei Mincu RSS" href="https://mstdn.ro/@matei.rss">
  <link rel="stylesheet" href="/assets/styles.css">
</head>
<body>
  <nav class="nav">
    <div class="nav-inner">
      <a class="brand" href="/" aria-label="Romania RSS Feed homepage">
        <svg class="brand-logo" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="16" cy="16" r="14" fill="var(--accent)"/>
          <path d="M16 8 L20 16 L16 20 L12 16 Z" fill="var(--bg)"/>
        </svg>
        <span>Romania RSS Feed</span>
      </a>
      <div class="nav-links">
        <a href="/profiles/">Explorator</a>
        <a href="/stats/">Statistici</a>
        <a href="/feed.xml">RSS Feed</a>
        <a href="https://social.5th.ro/" target="_blank" rel="noopener">Mastodon</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <div class="profile-page">
      <div class="profile-banner"></div>
      <div class="profile-header-large">
        <div class="profile-avatar-large">
          <img src="https://mstdn.ro/system/accounts/avatars/109/709/061/149/619/013/original/6c2b15bda214466b.jpg" alt="Matei Mincu" style="width:100%;height:100%;object-fit:cover;border-radius:var(--radius-lg);" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
          <span style="display:none;">M</span>
        </div>
        <div class="profile-details">
          <h1 class="profile-name-large">Matei Mincu</h1>
          <p class="profile-username-large"><a href="https://mstdn.ro/@matei" target="_blank" rel="noopener" style="color: inherit; text-decoration: none;">@matei@mstdn.ro</a></p>
          <div class="profile-description-large"></div>
        </div>
      </div>

      <div class="profile-stats-large">
        <div class="profile-stat-large">
          <div class="stat-value">0</div>
          <div class="stat-label">Postări</div>
        </div>
        <div class="profile-stat-large">
          <div class="stat-value">6</div>
          <div class="stat-label">Urmăritori</div>
        </div>
        <div class="profile-stat-large">
          <div class="stat-value">3</div>
          <div class="stat-label">Urmărește</div>
        </div>
        <div class="profile-stat-large">
          <div class="stat-value">18 Jan 2023</div>
          <div class="stat-label">Membru din</div>
        </div>
      </div>

      <div style="margin: 40px 0; padding: 32px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg);">
        <h2 style="font-size: 24px; font-weight: 700; margin: 0 0 24px; color: var(--text);">Link-uri</h2>
        <div style="display: flex; flex-direction: column; gap: 16px;">
          <a href="https://mstdn.ro/@matei" target="_blank" rel="noopener nofollow" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 8px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
            Vezi pe Mastodon
          </a>
          <a href="https://mstdn.ro/@matei.rss" target="_blank" rel="noopener nofollow" class="rss-link" style="font-size: 16px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 11a9 9 0 0 1 9 9"></path>
              <path d="M4 4a16 16 0 0 1 16 16"></path>
              <circle cx="5" cy="19" r="1"></circle>
            </svg>
            Abonează-te la RSS Feed
          </a>
        </div>
      </div>

      <div id="postsSection" style="margin: 40px 0; padding: 32px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg);">
        <h2 style="font-size: 24px; font-weight: 700; margin: 0 0 24px; color: var(--text);">Postări Recente</h2>
        <div id="postsContainer" style="display: flex; flex-direction: column; gap: 24px;">
          <div style="text-align: center; padding: 40px; color: var(--text-muted);">
            <div class="loading-spinner" style="display: inline-block; width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <p style="margin-top: 16px;">Se încarcă postările...</p>
          </div>
        </div>
        <button id="loadMoreBtn" style="display: none; margin-top: 24px; padding: 12px 24px; background: var(--accent); color: var(--bg); border: none; border-radius: var(--radius); font-size: 16px; font-weight: 600; cursor: pointer; width: 100%;" onclick="loadMorePosts()">
          Arată mai multe
        </button>
      </div>

      <div id="relatedProfilesSection" style="margin: 40px 0; padding: 32px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg);">
        <h2 style="font-size: 24px; font-weight: 700; margin: 0 0 24px; color: var(--text);">Alte Profile</h2>
        <div id="relatedProfilesContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
          <div style="text-align: center; padding: 40px; color: var(--text-muted);">
            <div class="loading-spinner" style="display: inline-block; width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <p style="margin-top: 16px;">Se încarcă profilele...</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    const profileData = {
      "username": "matei",
      "instance": "mstdn.ro",
      "acct": "matei@mstdn.ro",
      "rss_url": "https://mstdn.ro/@matei.rss"
    };
    
    let postsOffset = 0;
    const postsPerPage = 10;
    let allPosts = []; // Cache all loaded posts
    
    // Delay function for rate limiting
    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    async function loadPostsFromRSS(offset = 0, limit = 10) {
      try {
        // If we already have posts cached, return slice
        if (allPosts.length > 0) {
          return allPosts.slice(offset, offset + limit);
        }
        
        // Add delay before fetching RSS (rate limiting)
        await delay(offset * 200); // 200ms delay per offset
        
        const rssUrl = profileData.rss_url;
        const response = await fetch(rssUrl);
        
        if (!response.ok) {
          throw new Error('Failed to load RSS feed');
        }
        
        const xmlText = await response.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
        
        // Parse RSS items
        const items = xmlDoc.querySelectorAll('item');
        const posts = [];
        
        items.forEach((item, index) => {
          const title = item.querySelector('title')?.textContent || '';
          const description = item.querySelector('description')?.textContent || '';
          const link = item.querySelector('link')?.textContent || '';
          const pubDate = item.querySelector('pubDate')?.textContent || '';
          const guid = item.querySelector('guid')?.textContent || link;
          
          // Skip replies and reblogs (they usually have specific patterns)
          if (title.includes('@') && title.startsWith('@')) {
            return; // Skip replies
          }
          
          posts.push({
            id: guid,
            content: description || title,
            created_at: pubDate,
            url: link
          });
        });
        
        // Cache all posts
        allPosts = posts;
        
        // Return requested slice
        return posts.slice(offset, offset + limit);
      } catch (error) {
        console.error('Error loading posts from RSS:', error);
        return [];
      }
    }
    
    async function loadPosts(offset = 0, limit = 10) {
      return await loadPostsFromRSS(offset, limit);
    }
    
    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) return 'acum';
      if (diffMins < 60) return diffMins + 'm';
      if (diffHours < 24) return diffHours + 'h';
      if (diffDays < 7) return diffDays + 'd';
      
      return date.toLocaleDateString('ro-RO', { year: 'numeric', month: 'short', day: 'numeric' });
    }
    
    function addNofollowToLinks(html) {
      return html.replace(/<a\s+([^>]*?)>/gi, (match, attrs) => {
        if (!attrs.includes('rel=')) {
          return '<a ' + attrs + ' rel="nofollow noopener">';
        } else if (!attrs.includes('nofollow')) {
          const relMatch = attrs.match(/rel="([^"]*)"/);
          if (relMatch) {
            return '<a ' + attrs.replace(/rel="[^"]*"/, 'rel="' + relMatch[1] + ' nofollow noopener"') + '>';
          }
        }
        return match;
      });
    }
    
    function renderPost(post) {
      // Add nofollow to all links in post content (but keep Mastodon post link dofollow)
      const postUrl = post.url || `https://${profileData.instance}/@${profileData.username}/${post.id}`;
      let content = post.content || '';
      
      // Replace all links in content with nofollow
      content = content.replace(/<a\s+([^>]*?)>/gi, (match, attrs) => {
        const hrefMatch = attrs.match(/href="([^"]*)"/);
        const href = hrefMatch ? hrefMatch[1] : '';
        
        // All links in content get nofollow
        if (!attrs.includes('rel=')) {
          return '<a ' + attrs + ' rel="nofollow noopener">';
        } else if (!attrs.includes('nofollow')) {
          const relMatch = attrs.match(/rel="([^"]*)"/);
          if (relMatch) {
            return '<a ' + attrs.replace(/rel="[^"]*"/, 'rel="' + relMatch[1] + ' nofollow noopener"') + '>';
          }
        }
        return match;
      });
      
      const createdAt = formatDate(post.created_at);
      
      return `
        <div class="post-item" style="padding: 20px; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius-lg);">
          <div style="display: flex; gap: 12px; margin-bottom: 12px;">
            <div style="flex: 1;">
              <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 8px;">
                <a href="${postUrl}" target="_blank" rel="noopener" style="color: var(--text-muted); text-decoration: none;">
                  ${createdAt}
                </a>
              </div>
              <div style="color: var(--text); line-height: 1.6;" class="post-content">
                ${content}
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 16px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
            <a href="${postUrl}" target="_blank" rel="noopener" style="display: inline-flex; align-items: center; gap: 6px; color: var(--text-muted); text-decoration: none; font-size: 14px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
              Vezi pe Mastodon
            </a>
          </div>
        </div>
      `;
    }
    
    async function loadMorePosts() {
      const btn = document.getElementById('loadMoreBtn');
      btn.style.display = 'none';
      btn.textContent = 'Se încarcă...';
      
      postsOffset += postsPerPage;
      const newPosts = await loadPosts(postsOffset, postsPerPage);
      
      if (newPosts.length > 0) {
        const container = document.getElementById('postsContainer');
        newPosts.forEach(post => {
          container.insertAdjacentHTML('beforeend', renderPost(post));
        });
        
        if (newPosts.length === postsPerPage) {
          btn.style.display = 'block';
          btn.textContent = 'Arată mai multe';
        } else {
          btn.style.display = 'none';
        }
      } else {
        btn.style.display = 'none';
      }
    }
    
    async function loadRelatedProfiles() {
      try {
        const response = await fetch('/data/profiles.json');
        if (!response.ok) throw new Error('Failed to load profiles');
        const allProfiles = await response.json();
        
        // Filter out current profile
        const currentUsername = profileData.username;
        const otherProfiles = allProfiles.filter(p => p.username !== currentUsername);
        
        // Shuffle and get 4-6 random profiles
        const shuffled = otherProfiles.sort(() => Math.random() - 0.5);
        const randomCount = Math.floor(Math.random() * 3) + 4; // 4-6 profiles
        const selectedProfiles = shuffled.slice(0, randomCount);
        
        return selectedProfiles;
      } catch (error) {
        console.error('Error loading related profiles:', error);
        return [];
      }
    }
    
    function renderRelatedProfile(profile) {
      const displayName = profile.display_name || profile.username || 'Fără nume';
      const username = profile.username || '';
      const acct = profile.acct || username + '@' + (profile.instance || 'social.5th.ro');
      const avatar = profile.avatar || '';
      const avatarInitial = displayName.charAt(0).toUpperCase();
      const followers = profile.followers_count || 0;
      const posts = profile.statuses_count || 0;
      const profileUrl = '/profiles/' + encodeURIComponent(username) + '/';
      
      return '<a href="' + profileUrl + '" style="text-decoration: none; color: inherit;"><div class="related-profile-card" style="padding: 20px; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius-lg); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;" onmouseover="this.style.transform=\'translateY(-4px)\'; this.style.boxShadow=\'0 4px 12px rgba(0,0,0,0.1)\';" onmouseout="this.style.transform=\'\'; this.style.boxShadow=\'\';"><div style="display: flex; flex-direction: column; align-items: center; text-align: center; gap: 12px;"><div style="width: 64px; height: 64px; border-radius: var(--radius-lg); background: var(--surface); display: flex; align-items: center; justify-content: center; overflow: hidden; border: 2px solid var(--border);">' + (avatar ? '<img src="' + avatar + '" alt="' + displayName + '" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display=\'none\'; this.nextElementSibling.style.display=\'flex\';"><span style="display:none;font-size:24px;font-weight:600;">' + avatarInitial + '</span>' : '<span style="font-size:24px;font-weight:600;">' + avatarInitial + '</span>') + '</div><div style="flex: 1;"><h3 style="font-size: 16px; font-weight: 600; margin: 0 0 4px; color: var(--text);">' + (displayName.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;')) + '</h3><p style="font-size: 14px; color: var(--text-muted); margin: 0 0 8px;">@' + (acct.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;')) + '</p><div style="display: flex; gap: 12px; justify-content: center; font-size: 12px; color: var(--text-muted);"><span>' + (followers >= 1000 ? (followers / 1000).toFixed(1) + 'k' : followers.toString()) + ' urmăritori</span><span>•</span><span>' + (posts >= 1000 ? (posts / 1000).toFixed(1) + 'k' : posts.toString()) + ' postări</span></div></div></div></div></a>';
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
      const container = document.getElementById('postsContainer');
      
      // Add initial delay (rate limiting)
      await delay(100);
      
      const posts = await loadPosts(0, postsPerPage);
      
      if (posts.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">Nu există postări disponibile.</p>';
        document.getElementById('loadMoreBtn').style.display = 'none';
      } else {
        container.innerHTML = posts.map(renderPost).join('');
        
        // Show "load more" button if there are more posts available
        if (allPosts.length > postsPerPage) {
          document.getElementById('loadMoreBtn').style.display = 'block';
        }
      }
      
      // Load related profiles
      const relatedContainer = document.getElementById('relatedProfilesContainer');
      if (relatedContainer) {
        const relatedProfiles = await loadRelatedProfiles();
        if (relatedProfiles.length > 0) {
          relatedContainer.innerHTML = relatedProfiles.map(renderRelatedProfile).join('');
        } else {
          relatedContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">Nu există alte profile disponibile.</p>';
        }
      }
    });
  </script>
  
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .post-content a {
      color: var(--accent);
      text-decoration: none;
    }
    .post-content a:hover {
      text-decoration: underline;
    }
    .post-content img {
      max-width: 100%;
      height: auto;
      border-radius: var(--radius);
      margin: 8px 0;
    }
  </style>

  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Link-uri Rapide</h3>
          <nav>
            <a href="/">Acasă</a>
            <a href="/profiles/">Explorator</a>
            <a href="/stats/">Statistici</a>
            <a href="/feed.xml">RSS Feed</a>
          </nav>
        </div>
        <div class="footer-section">
          <h3>Despre</h3>
          <p>Romania RSS Feed este un explorator modern pentru profilurile Mastodon de pe social.5th.ro.</p>
        </div>
        <div class="footer-section">
          <h3>Server Mastodon</h3>
          <a href="https://social.5th.ro/" target="_blank" rel="noopener">social.5th.ro</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Romania RSS Feed. Hub pentru profiluri Mastodon din România.</p>
      </div>
    </div>
  </footer>
</body>
</html>
